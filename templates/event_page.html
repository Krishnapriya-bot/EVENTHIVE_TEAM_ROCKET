<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ event.title }} - EventHive</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='screen3.css') }}"
    />
  </head>
  <body>
    <!-- Header -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-content">
                <div class="nav-left">
                    <h1 class="logo">EventHive</h1>
                </div>
                <div class="nav-right">
                    <span class="welcome-text">Welcome, {{ name }}!</span>
                    <a href="{{ url_for('logout') }}" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
      <!-- Event Content -->
      <div class="event-content">
        <!-- Main Event Section -->
        <div class="event-main">
          <div class="event-header">
            <div class="event-image">
             {% if event.image_url %}
              <img
                src="{{ event.image_url }}"
                alt="{{ event.title }}"
                class="w-100 rounded"
              />
              {% else %}
              <div
                class="bg-light d-flex justify-content-center align-items-center"
                style="height: 250px"
              >
                <span class="text-muted">No Image Available</span>
              </div>
              {% endif %}

              <div class="event-badge">
                {% if event.get_total_bookings() > 0 %} Registered {% else %}
                Upcoming {% endif %}
              </div>

              <div class="event-title">{{ event.title }}</div>
              <div class="event-tagline">
                {{ event.description[:100] }}{% if event.description|length >
                100 %}...{% endif %}
              </div>
            </div>
          </div>

          <!-- Event Description -->
          <div class="event-description">
            <h3>About This Event</h3>
            <p>{{ event.description }}</p>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="event-sidebar">
          <div class="register-section">
            <a
              href="{{ url_for('join_event', event_id=event.event_id) }}"
              class="btn"
              >Join</a
            >
            <div class="event-date">
              {{ event.start_datetime.strftime('%b %d, %Y') }}
            </div>
            <div class="event-time">
              {{ event.start_datetime.strftime('%I:%M %p') }} - {{
              event.end_datetime.strftime('%I:%M %p') }}
            </div>
            <div class="event-duration">Add to calendar</div>
          </div>

          <!-- Location Section -->
          <div class="location-section">
            <h3><span class="location-icon">üìç</span> Location</h3>
            <div class="location-address">{{ event.location }}</div>
            <div
              id="map"
              style="height: 200px; margin-top: 10px"
              data-lat="{{ lat or 28.6139 }}"
              data-lon="{{ lon or 77.2090 }}"
            ></div>
          </div>

          <!-- Organizer Section -->
          <div class="organizer-section">
            <h3>Organizer</h3>
            <div class="organizer-name">{{ organizer.name }}</div>
            <div class="organizer-contact">
              üìû {{ organizer.phone or "N/A" }}
            </div>
            <div class="organizer-contact">‚úâÔ∏è {{ organizer.email }}</div>
          </div>

          <!-- Share Section -->
          <div class="share-section">
            <h3>Share Event</h3>
            <div class="share-text">
              Tell your friends about this event
            </div>
            <div class="social-buttons">
              <button class="social-btn facebook" onclick="shareOn('facebook')" title="Share on Facebook">
                <i class="fab fa-facebook-f"></i>
              </button>
              <button class="social-btn twitter" onclick="shareOn('twitter')" title="Share on Twitter">
                <span>X</span>
              </button>
              <button class="social-btn linkedin" onclick="shareOn('linkedin')" title="Share on LinkedIn">
                <i class="fab fa-linkedin-in"></i>
              </button>
              <button class="social-btn whatsapp" onclick="shareOn('whatsapp')" title="Share on WhatsApp">
                <i class="fab fa-whatsapp"></i>
              </button>
              <button class="social-btn sms" onclick="shareOn('sms')" title="Share via SMS">
                <i class="fas fa-sms"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="successMessage" class="success-message"></div>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
      const mapDiv = document.getElementById("map");
      const lat = parseFloat(mapDiv.getAttribute("data-lat"));
      const lon = parseFloat(mapDiv.getAttribute("data-lon"));

      const map = L.map("map").setView([lat, lon], 15);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "¬© OpenStreetMap contributors",
      }).addTo(map);
      L.marker([lat, lon])
        .addTo(map)
        .bindPopup(mapDiv.previousElementSibling.textContent.trim())
        .openPopup();
    </script>

    <script>
        // Event data - Update with your actual event details
        const eventData = {
            title: "{{ event.title }}",
            description: "{{ event.description[:100] }}{% if event.description|length > 100 %}...{% endif %}",
            url: window.location.href,
            location: "{{ event.location }}"
        };

        // Show success message
        function showMessage(message) {
            let messageDiv = document.getElementById('successMessage');
            if (!messageDiv) {
                messageDiv = document.createElement('div');
                messageDiv.id = 'successMessage';
                messageDiv.className = 'success-message';
                document.body.appendChild(messageDiv);
            }
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }

        // Create share message
        function createShareMessage() {
            return `üéâ ${eventData.title}\n\n${eventData.description}\n\nüìç ${eventData.location}\n\nüîó ${eventData.url}`;
        }

        // Share function
        function shareOn(platform) {
            const message = createShareMessage();
            const url = eventData.url;
            const title = eventData.title;
            
            let shareUrl = '';
            
            switch(platform) {
                case 'facebook':
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
                    break;
                    
                case 'twitter':
                    let twitterMessage = message;
                    if (twitterMessage.length > 280) {
                        twitterMessage = twitterMessage.substring(0, 277) + '...';
                    }
                    shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(twitterMessage)}`;
                    break;
                    
                case 'linkedin':
                    shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`;
                    break;
                    
                case 'whatsapp':
                    shareUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
                    break;
                    
                case 'sms':
                    shareUrl = `sms:?body=${encodeURIComponent(message)}`;
                    break;
            }
            
            if (shareUrl) {
                if (platform === 'sms') {
                    window.location.href = shareUrl;
                } else {
                    window.open(shareUrl, '_blank', 'width=600,height=400');
                }
                showMessage(`Opening ${platform}...`);
                trackShare(platform);
            }
        }

        // Track sharing (optional)
        function trackShare(platform) {
            console.log(`Shared on: ${platform}`);
        }
    </script>
  </body>
</html>