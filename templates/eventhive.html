<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EventHive</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='screen2.css') }}"
    />
    <style>
      .event-image img {
        max-width: 100%;
        max-height: 180px;
        object-fit: cover;
        display: block;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <!-- Header 
    <header class="header">
      <div class="logo">EventHive</div>
      <div class="header-right">
        <span class="my-bookings">My bookings</span>
        <div class="profile-section">
          <div class="notification-icon">üîî</div>
          <div class="profile-avatar">JD</div>
        </div>
      </div>
    </header>-->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-content">
                <div class="nav-left">
                    <h1 class="logo">EventHive</h1>
                </div>
                <div class="nav-right">
                    <span class="welcome-text">Welcome, {{ name }}!</span>
                    <a href="{{ url_for('logout') }}" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>
    <!-- Main Content -->
    <main class="main-container">
      <h1 class="page-title">Attendee Home page</h1>

      <!-- Filter Bar -->
      <div
        class="filter-bar d-flex justify-content-between align-items-center mb-3"
      >
        <div class="filter-group d-flex">
          <!-- Category Filter -->
          <select class="filter-select me-2" id="categoryFilter">
            <option value="">All Categories</option>
            {% for cat in categories %}
            <option value="{{ cat }}">{{ cat }}</option>
            {% endfor %}
          </select>

          <!-- Date Filter -->
          <select class="filter-select" id="dateFilter">
            <option value="">All Dates</option>
            <option value="today">Today</option>
            <option value="this_week">This Week</option>
            <option value="this_month">This Month</option>
            <option value="next_month">Next Month</option>
          </select>
        </div>

        <!-- Search Box -->
        <div class="search-container d-flex align-items-center">
          <input
            type="text"
            class="search-input form-control"
            id="searchBox"
            placeholder="Search events"
          />
          <span class="search-icon ms-2">üîç</span>
        </div>
      </div>

      <!-- Events Grid -->
      <div class="events-grid row" id="eventsGrid">
        {% for event in events %}
        <div
          class="col-md-4 mb-4 event-item"
          data-category="{{ event.category }}"
          data-title="{{ event.title }}"
          data-start="{{ event.start_datetime.strftime('%Y-%m-%d') }}"
        >
          <div class="event-card card shadow-sm h-100">
            <a
              href="{{ url_for('event_page', event_id=event.event_id) }}"
              class="btn btn-primary btn-sm"
            >
              <div class="event-image position-relative">
                {% if event.image_url %}
                <img src="{{ event.image_url }}" alt="{{ event.title }}" />

                {% else %}
                <!-- fallback placeholder if no image -->
                <div
                  class="card-img-top d-flex align-items-center justify-content-center bg-light"
                  style="height: 180px"
                >
                  <span class="text-muted">No Image</span>
                </div>
                {% endif %}
              </div>

              <!-- Event Content -->
              <div class="event-content card-body">
                <h5 class="event-title card-title">{{ event.title }}</h5>
                <p class="event-description card-text">
                  {{ event.description[:120] }}{% if event.description|length >
                  120 %}...{% endif %}
                </p>

                <div class="event-details mb-2 text-muted small">
                  <div>
                    <i class="bi bi-calendar-event"></i>
                    {{ event.start_datetime.strftime('%d %b %Y %I:%M %p') }}
                  </div>
                  <div><i class="bi bi-geo-alt"></i> {{ event.location }}</div>
                  <div><i class="bi bi-tag"></i> {{ event.category }}</div>
                </div>
                <strong>Max Attendees:</strong> {{ event.max_attendees or
                "Unlimited" }} <strong>Registered:</strong> {{
                event.get_total_bookings() }}
              </div>
            </a>
            <!-- Event Image -->
          </div>
        </div>
        {% endfor %}
      </div>
    </main>

    <!-- Filtering Script -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const categoryFilter = document.getElementById("categoryFilter");
        const dateFilter = document.getElementById("dateFilter");
        const searchBox = document.getElementById("searchBox");
        const events = document.querySelectorAll(".event-item");

        function filterEvents() {
          const category = categoryFilter.value.toLowerCase();
          const dateRange = dateFilter.value;
          const search = searchBox.value.toLowerCase();
          const today = new Date();

          events.forEach((event) => {
            const eventCategory = event.dataset.category.toLowerCase();
            const eventTitle = event.dataset.title.toLowerCase();
            const eventDate = new Date(event.dataset.start);

            let matchesCategory = !category || eventCategory === category;
            let matchesSearch = !search || eventTitle.includes(search);

            // Handle date filter
            let matchesDate = true;
            if (dateRange === "today") {
              matchesDate = eventDate.toDateString() === today.toDateString();
            } else if (dateRange === "this_week") {
              const startOfWeek = new Date(today);
              startOfWeek.setDate(today.getDate() - today.getDay());
              const endOfWeek = new Date(startOfWeek);
              endOfWeek.setDate(startOfWeek.getDate() + 6);
              matchesDate = eventDate >= startOfWeek && eventDate <= endOfWeek;
            } else if (dateRange === "this_month") {
              matchesDate =
                eventDate.getMonth() === today.getMonth() &&
                eventDate.getFullYear() === today.getFullYear();
            } else if (dateRange === "next_month") {
              const nextMonth = new Date(today);
              nextMonth.setMonth(today.getMonth() + 1);
              matchesDate =
                eventDate.getMonth() === nextMonth.getMonth() &&
                eventDate.getFullYear() === nextMonth.getFullYear();
            }

            // Show or hide
            if (matchesCategory && matchesSearch && matchesDate) {
              event.style.display = "";
            } else {
              event.style.display = "none";
            }
          });
        }

        categoryFilter.addEventListener("change", filterEvents);
        dateFilter.addEventListener("change", filterEvents);
        searchBox.addEventListener("input", filterEvents);
      });
    </script>
  </body>
</html>
